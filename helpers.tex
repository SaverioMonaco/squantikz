% Gates
\newcommand{\gateR}[3]{%
	\gate[style={fill=#3!30, inner ysep=-1pt}]%
	{\!\textit{R#1}(\theta_{#2})\!}%
}
\newcommand{\gateFx}[2]{%
	\gate[style={fill=#2!30}]{\mathcal{F}(x_{#1})}%
}
\newcommand{\gateUtheta}[1]{%
	\gate[4, style={fill=#1!30}]{\,\, U(\vec{\theta}) \,\,}
}

% Slices
\newcommand{\slicephix}{%
	\slice[style={draw=gray}, label style={pos=1, anchor=north}]{\raisebox{-.34cm}{$|\phi(\vec{x})\rangle$}}%
}
\newcommand{\slicepsithetax}{%
	\slice[style={draw=gray}, label style={pos=1, anchor=north}]{$|\psi(\vec{\theta}, \vec{x})\rangle$}
}
\newcommand{\slicephixw}{%
	\slice[style={draw=white}, label style={pos=1, anchor=north}]{\raisebox{-.34cm}{\color{white}$|\phi(\vec{x})\rangle$}}%
}
\newcommand{\slicepsithetaxw}{%
	\slice[style={draw=white}, label style={pos=1, anchor=north}]{\color{white}$|\psi(\vec{\theta}, \vec{x})\rangle$}
}
\newcommand{\slicezero}{%
	\slice[style={draw=gray}, label style={pos=1, anchor=north}]{$|0\rangle^{\otimes N}$}
}
\newcommand{\slicepsiUzero}{%
	\slice[style={draw=gray}, label style={pos=1, anchor=north}]{\hspace*{2cm}$|\psi(\vec{\theta})\rangle = U(\vec{\theta})|0\rangle^{\otimes N}$}
}
\newcommand{\slicegen}[1]{
	\slice[style={draw=gray}, label style={pos=1, anchor=north}]{#1}
}

% Groups
\newcommand{\group}[3]{%
	\gategroup[4,steps=#3,style={dashed,rounded corners,fill=#2!30, inner xsep=2pt},background,
		label style={label position=above,anchor=north,yshift=+0.3cm}]{#1}%
}

% Measurements
\newcommand{\qmeter}[1]{\meter{}\rstick[1, brackets=none]{\,\,#1}}
% Pixel display size
\def\pixsize{5pt}
% White pixel (empty cell)
\newcommand{\wpix}{%
	\gate[]{\textcolor{white}{\rule{\pixsize}{\pixsize}}}%
}

% Black pixel (filled cell)
\newcommand{\bpix}{%
	\gate[style={fill=black!80}]{\textcolor{black!80}{\rule{\pixsize}{\pixsize}}}%
}

% States
\newcommand{\mdots}{\raisebox{.2cm}{\vdots}}

% Other
\newcommand{\ostate}{\lstick{$|0\rangle$}}
\newcommand{\vstate}{\lstick{\mdots}\quad}

% Recursive macro to draw nodes from a binary string
\newcommand{\drawspins}[2]{%
	\IfStrEq{#1}{}{}{%
		\StrChar{#1}{1}[\bit]%
		% Place the current node at x = #2
		\ifnum\bit=0
			\node at (#2,0) {\input{tikz/spindown}};
		\else
			\ifnum\bit=1
				\node at (#2,0) {\input{tikz/spinup}};
			\else
				\node at (#2,0) {\scalebox{2}{$\cdots$}};
			\fi
		\fi
		% Recurse with the next x-coordinate
		\StrGobbleLeft{#1}{1}[\rest]%
		\pgfmathsetmacro{\next}{#2 + 1.5}%
		\drawspins{\rest}{\next}%
	}%
}