\newcommand{\ygate}{\gate{R_y(\cdot)}}
\newcommand{\zgate}{\gate{R_z(\cdot)}}
\begin{quantikz}[column sep=5pt, row sep={0.7cm,between origins}]
	\gategroup[6,steps=3,style={inner xsep=1pt,fill=\maincolor}, background]{{\sc ciao}} & \gate[6,nwires={1,2,3,4,5,6}, style={fill=\secondarycolor, rounded corners}]{\ket{\psi(\kappa,h)}} & \qw & \qw & \qw\gategroup[6,steps=22,style={fill=\tertiarycolor, inner xsep=-2pt}, background]{{\sc Autoencoder}} & \gate{R_y(\cdot)} & \qw      & \qw      & \qw       & \ctrl{2}  & \qw      & \gate{R_z(\cdot)} & \qw      & \qw         & \qw       & \ctrl{3} & \qw      & \qw       & \gate{R_z(\cdot)} & \qw      & \qw      & \qw       & \ctrl{4} & \qw       & \qw               & \qw & \qw            &                             \\
	                                                                                     &                                                                                                    & \qw & \qw & \qw                                                                                                   & \gate{R_y(\cdot)} & \qw      & \qw      & \qw       & \qw       & \ctrl{2} & \gate{R_z(\cdot)} & \qw      & \qw         & \qw       & \qw      & \ctrl{3} & \qw       & \gate{R_z(\cdot)} & \qw      & \qw      & \qw       & \qw      & \ctrl{1}  & \qw               & \qw & \qw            &                             \\
	                                                                                     &                                                                                                    & \qw & \qw & \qw                                                                                                   & \gate{R_y(\cdot)} & \ctrl{1} & \qw      & \phase{}  & \targ{}   & \qw      & \gate{R_z(\cdot)} & \ctrl{2} & \phase{}\qw & \qw       & \qw      & \qw      & \targ{}   & \gate{R_z(\cdot)} & \ctrl{1} & \qw      & \phase{}  & \qw      & \targ{}   & \gate{R_y(\cdot)} & \qw & \left<Z\right> & \rstick[3]{$\mathcal{C}$} & \\
	                                                                                     &                                                                                                    & \qw & \qw & \qw                                                                                                   & \gate{R_y(\cdot)} & \phase{} & \ctrl{1} & \qw       & \qw       & \targ{}  & \gate{R_z(\cdot)} & \qw      & \ctrl{-1}   & \phase{}  & \targ{}  & \qw      & \qw       & \gate{R_z(\cdot)} & \phase{} & \ctrl{1} & \qw       & \qw      & \targ{}   & \gate{R_y(\cdot)} & \qw & \left<Z\right> &                             \\
	                                                                                     &                                                                                                    & \qw & \qw & \qw                                                                                                   & \gate{R_y(\cdot)} & \qw      & \phase{} & \ctrl{-2} & \targ{}   & \qw      & \gate{R_z(\cdot)} & \phase{} & \qw         & \ctrl{-1} & \qw      & \targ{}  & \qw       & \gate{R_z(\cdot)} & \qw      & \phase{} & \ctrl{-2} & \targ{}  & \qw       & \gate{R_y(\cdot)} & \qw & \left<Z\right> &                             \\
	                                                                                     &                                                                                                    & \qw & \qw & \qw                                                                                                   & \gate{R_y(\cdot)} & \qw      & \qw      & \qw       & \ctrl{-1} & \qw      & \gate{R_z(\cdot)} & \qw      & \qw         & \qw       & \qw      & \qw      & \ctrl{-3} & \gate{R_z(\cdot)} & \qw      & \qw      & \qw       & \qw      & \ctrl{-2} & \qw               & \qw & \qw            &
\end{quantikz}